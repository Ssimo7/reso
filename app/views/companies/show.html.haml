- meta title: t('.data_on', company_name: @company.name)

#company-show
  %h1= t('.informations_on', company_name: @company.name)

  - entreprise = @company.entreprise
  %table.ui.compact.celled.table
    %tbody
      %tr
        %td= t('.raison_sociale')
        %td= entreprise.raison_sociale
      - if entreprise.nom_commercial != entreprise.raison_sociale
        %tr
          %td= t('.nom_commercial')
          %td= entreprise.nom_commercial
      %tr
        %td= t('.categorie_entreprise')
        %td= entreprise.categorie_entreprise
      %tr
        %td= t('.tranche_effectif_salarie_entreprise')
        %td= entreprise.tranche_effectif_salarie_entreprise['intitule']
      %tr
        %td= t('.siren')
        %td= entreprise.siren
      %tr
        %td= t('.capital_social')
        %td= "#{entreprise.capital_social} â‚¬"
      %tr
        %td= t('.numero_tva_intracommunautaire')
        %td= entreprise.numero_tva_intracommunautaire
      %tr
        %td= t('.forme_juridique')
        %td= entreprise.forme_juridique
      %tr
        %td= t('.procedure_collective')
        %td= entreprise.procedure_collective.to_b ? t('yes') : t('no')
      %tr
        %td= t('.date_creation')
        %td= date_from_timestamp(entreprise.date_creation)
      - if entreprise.nom.present?
        %tr
          %td= t('.nom')
          %td= entreprise.nom
      - if entreprise.prenom.present?
        %tr
          %td= t('.prenom')
          %td= entreprise.prenom
      %tr
        %td= t('.date_radiation')
        %td= date_from_timestamp(entreprise.date_radiation)

  .toggle-div-wrapper
    %button.ui.basic.blue.icon.tiny.button.toggle-show-button
      %i.ui.icon.chevron.right
      = t('show_more')
    %button.ui.basic.blue.icon.tiny.button.toggle-hide-button
      %i.ui.icon.chevron.down
      = t('show_less')
    .toggle-div

      %h2= t('.facility')
      .toggle-div-wrapper
        %button.ui.blue.tiny.button.toggle-show-button= t('show')
        %button.ui.blue.tiny.button.toggle-hide-button= t('hide')
        .toggle-div
          = render partial: 'facility', locals: { etablissement: @facility.etablissement }

      - unless @facility.etablissement['siege_social'].to_b
        %h2= t('.siege_social')
        .toggle-div-wrapper
          %button.ui.blue.tiny.button.toggle-show-button= t('show')
          %button.ui.blue.tiny.button.toggle-hide-button= t('hide')
          .toggle-div
            = render partial: 'facility', locals: { etablissement: @company.etablissement_siege }

      %h2= t('.mandataires_sociaux')
      .toggle-div-wrapper
        %button.ui.blue.tiny.button.toggle-show-button= t('show')
        %button.ui.blue.tiny.button.toggle-hide-button= t('hide')
        .toggle-div#mandataires
          - entreprise.mandataires_sociaux.each do |person|
            %table.ui.compact.celled.table{class: (person['type'] == 'PM' ? 'violet' : 'teal')}
              %tbody
                - if person['type'] == 'PM'
                  %tr
                    %td{colspan: 2}= t('.personne_morale')
                - if person['raison_sociale'].present?
                  %tr
                    %td= t('.raison_sociale')
                    %td= person['raison_sociale'].humanize
                - if person['prenom'].present? && person['nom'].present?
                  %tr
                    %td= t('.nom')
                    %td= "#{person['prenom'].humanize} #{person['nom'].humanize}"
                - if person['fonction'].present?
                  %tr
                    %td= t('.fonction')
                    %td= person['fonction'].humanize
                - if person['date_naissance_timestamp']
                  %tr
                    %td= t('.date_naissance')
                    %td= date_from_timestamp(person['date_naissance_timestamp'])
                %tr
                  %td= t('.dirigeant')
                  %td= person['dirigeant'].to_b ? t('yes') : t('no')
                - if person['identifiant'].present?
                  %tr
                    %td= t('.identifiant')
                    %td= person['identifiant']

      %h2= t('.ereputation')
      .toggle-div-wrapper
        %button.ui.blue.tiny.button.toggle-show-button= t('show')
        %button.ui.blue.tiny.button.toggle-hide-button= t('hide')
        .toggle-div
          - if @qwant_results.blank? || @qwant_results['data']['result']['items'].count == 0
            %p= t('.information_not_found')
          - else
            .ui.items
              - @qwant_results['data']['result']['items'].each do |item|
                .item
                  .ui.tiny.image
                    - if item['media'].present?
                      = image_tag item['media'].first['pict']['url']
                  .content
                    = link_to item['title'].html_safe, item['url'], class: 'header'
                    .meta
                      %span= item['domain']
                    .description
                      %p= item['desc'].html_safe

  %h2= t('.diagnoses_completed', company_name: @company.name)
  - if @visits && @visits.count > 0
    %table.ui.table.ui
      %tbody
        - @visits.each do |visit|
          %tr
            %td
              %h3.ui.header
                = t('.visited_at', date: visit.happened_at_localized)
                .sub.header
                  = t('.visited_by_html', advisor_name: visit.advisor.full_name_with_role, advisor_email: visit.advisor.email)
            %td.collapsing
              .ui.middle.aligned.list
                .item
                  .middle.aligned.content
                    %h5.ui.header.disabled
                      = t('.diagnosed_needs', count: visit.diagnosis.diagnosed_needs.count)
                .item
                  .middle.aligned.content
                    %h5.ui.header.disabled
                      = t('.selected_assistance_experts', count: visit.diagnosis.selected_assistance_experts_count)
  - else
    %p.text.small
      = t('.no_visit_found')

  = link_to t('.create_diagnosis'), create_diagnosis_from_siret_companies_path(siret: params[:siret]),
   method: :post, class: 'ui positive basic tiny button'