- meta title: t('.title')

#step5-app
  %h1= t('.title')

  = render partial: 'needs/diagnosis_summary', locals: { diagnosis: @diagnosis }

  - visitee = @diagnosis.visit.visitee

  = render partial: 'people/person', locals: { person: visitee, subtitle: t('.company_contact_subtitle') }

  = link_to t('.show_detailed_information'), company_path(siret: @diagnosis.visit.facility.siret),
   target: '_blank', class: 'ui yellow basic tiny button'

  %h2= t('.need_contacts_summary_subtitle')
  - @diagnosis.diagnosed_needs.ordered_by_interview.each do |diagnosed_need|
    %table.ui.celled.table
      %thead
        %tr
          %th{ colspan: 3 }= diagnosed_need.question_label
      %tbody
        - if diagnosed_need.content.present?
          %tr
            %td{ colspan: 3 }
              .ui.form
                .field
                  %label= t('.diagnosed_needs_content_label')
                  = simple_format(diagnosed_need.content)
        - if diagnosed_need.matches.empty?
          %tr.small.text.ui.tiny.table{ colspan: 2 }
            %td= t('.zero_contacted_expert')
        - else
          - diagnosed_need.matches.each do |match|
            %tr.small.text.ui.tiny.table
              - locals = { match: match }
              = render partial: 'needs/match', locals: locals
            - match.feedbacks.each do |feedback|
              %tr.small.text.ui.tiny.table
                = render partial: 'needs/expert_feedback', locals: { feedback: feedback, can_delete: false }

  - if @diagnosis.content
    %h2= t('.diagnosis_content_subtitle')
    .ui.segment.shadow-less
      .ui.form
        .field
          = @diagnosis.content
