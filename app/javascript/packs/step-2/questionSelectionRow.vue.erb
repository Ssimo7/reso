<template>
    <tr v-bind:class="{ greyed: selected }">
      <td>
        <label v-bind:for="checkboxId">
          <div class="full-width clickable">
            {{questionData.label}}
          </div>
        </label>
      </td>
      <td class="collapsing">
        <div class="ui fitted checkbox">
          <input v-bind:id="checkboxId"
          type="checkbox" v-model="selected" value="on"/>
          <label></label>
        </div>
      </td>
    </tr>
</template>

<script>
import { mapState, mapGetters, mapMutations } from 'vuex'
import * as types from './store/mutationTypes'
import QuestionObjectParser from './utils/questionObjectParser'

export default {
    name: 'question-selection-row',
    props: [
        'questionDataSerialized'
    ],
    data () {
        return {
            questionData: {}
        }
    },
    created: function () {
        this.questionData = QuestionObjectParser.parse(this.questionDataSerialized)
        this.selectQuestion({ questionId: this.questionData.questionId, isSelected: this.questionData.isSelected })
        this.setQuestionLabel({ questionId: this.questionData.questionId, questionLabel: this.questionData.label })
    },
    computed: {
        ...mapState({
            isRequestInProgress: state => state.step2Store.isRequestInProgress
        }),
        ...mapGetters({
            getQuestionStateById: 'getQuestionStateById'
        }),
        checkboxId: function () {
            return `checkbox_${this.questionData.questionId}`
        },
        selected: {
            get () {
                return this.getQuestionStateById(this.questionData.questionId).isSelected
            },
            set (value) {
                this.selectQuestion({ questionId: this.questionData.questionId, isSelected: value })
            }
        }
    },
    methods: {
        ...mapMutations({
            selectQuestion: types.QUESTION_SELECTED,
            setQuestionLabel: types.QUESTION_LABEL
        })
    }
}
</script>

<style lang="sass">
  .greyed
    background-color: #F7F7F7
</style>
