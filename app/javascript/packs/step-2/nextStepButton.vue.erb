<template>
  <button class="ui teal right labeled icon button right floated"
  v-bind:class="{ loading: isRequestInProgress, disabled: isRequestInProgress }"
  @click="nextStepButtonClicked">
    <label><%= I18n.t('next_step') %></label>
    <i class="arrow right icon"></i>
  </button>
</template>

<script>
import { mapState, mapMutations, mapActions } from 'vuex'
import * as types from './store/mutationTypes'

export default {
  name: 'next-step-button',
  computed: {
    ...mapState({
      diagnosisId: state => state.step2Store.diagnosisId,
      diagnosisContent: state => state.step2Store.diagnosisContent,
      isRequestInProgress: state => state.step2Store.isRequestInProgress
    })
  },
  methods: {
    nextStepButtonClicked: function () {
      this.sendDiagnosisContentUpdate()
        .then(this.createSelectedQuestions())
        .then(() => {
          // TODO: Change after the right path is determined
          Turbolinks.visit(`/diagnoses/${this.diagnosisId}/step-3`)
        })
        .catch((error) => {
          console.log(`error: ${error}`)
        })
    },
    ...mapMutations({
      setRequestInProgress: types.REQUEST_IN_PROGRESS
    }),
    ...mapActions([
      'sendDiagnosisContentUpdate',
      'createSelectedQuestions'
    ])
  }
}
</script>

<style lang="sass">
</style>
